<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comment">
	<insert id="insertComment" parameterType="commentvo">
		<choose>
			<when test="fileNo == null ">
		   	  <![CDATA[
		      	insert into comment values(null, now(), #{commentContents}, 0, #{userNo}, #{taskNo}, #{fileNo})
		      ]]>
			</when>
			<otherwise>
	      	 <![CDATA[
		      	insert into comment values(null, now(), #{originName}, 0, #{userNo}, #{taskNo}, #{fileNo})
		      ]]>
			</otherwise>
		</choose>
		<selectKey keyProperty="commentNo" resultType="long"
			order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>

	<update id="updateCommentContents" parameterType="map">
			update comment set comment_contents=#{commentContents} where comment_no = #{commentNo}
	</update>
	
	<update id="updateCommentLike" parameterType="map">
		update comment set comment_like=#{commentLike} where comment_no = #{commentNo}
	</update>
	
	<delete id="deleteComment" parameterType="long">
		delete from comment where comment_no=#{commentNo}
	</delete>
	
	<delete id="deleteFile" parameterType="long">
		delete from file where file_no=#{fileNo}
	</delete>
	
	<select id="selectLikeUser" parameterType="map" resultType="commentlikeuservo">
		 <![CDATA[
			select user_no as userNo, 
				   comment_no as commentNo
		    from userlike
		    where comment_no=#{commentNo} and user_no = #{userNo}
	    ]]>
	</select>
	
	<insert id="insertLikeUser" parameterType="map">
		<![CDATA[
			insert into userlike values(#{commentNo}, #{userNo})
		]]>
	</insert>
	
	<delete id="deleteLikeUser" parameterType="map">
		<![CDATA[
			delete from userlike where user_no=#{userNo} and comment_no=#{commentNo}
		]]>
	</delete>
	
	<delete id="deleteUserLikeByCommentNo" parameterType="long">
		<![CDATA[
			delete from userlike where comment_no=#{commentNo}
		]]>
	</delete>
</mapper>