<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kanbanBoard">

	<!-- 테스크 리스트 select -->
	<select id="selectAllTaskList" resultType="tasklistvo">
		<![CDATA[
			select tl.tasklist_no as tasklistNo, tl.tasklist_name as taskListName, tl.tasklist_order as tasklistOrder, tl.project_no projectNo
			from project p
			join tasklist tl on(p.project_no = tl.project_no)
			where p.project_no = #{projectNo}
			order by tl.tasklist_order
		]]>
	</select>

	<!-- 테크스 select -->
	<select id="selectTasks" resultType="taskvo">
		<![CDATA[
			select task_no taskNo,
					date_format(task_start, '%Y-%m-%d') as taskStart,
					date_format(task_end, '%Y-%m-%d') as taskEnd,
					task_point taskPoint,
					task_label taskLabel,
					task_state taskState,
					task_contents taskContents,
					task_order taskOrder,
					tasklist_no tasklistNo,
					project_no projectNo
			from task
			where tasklist_no = #{taskListNo}
		    order by task_order desc
		]]>
	</select>

	<!-- 체크리스트 select -->
	<select id="selectCheckList" resultType="checklistvo">
		<![CDATA[
			select checklist_no checklistNo,
					checklist_contents checklistContents,
					checklist_state checklistState,
					task_no taskNo
			from checklist
			where task_no = #{taskNo}
 		]]>
	</select>

	<!-- 태그 select -->
	<select id="selectTag" resultType="taglistvo">
		<![CDATA[
			select tl.tag_no tagNo, 
					tt.task_no taskNo, 
					tl.tag_name tagName, 
					tl.tag_color tagColor
			from tagtask tt 
			join taglist tl using(tag_no)
			where tt.task_no = #{taskNo}
 		]]>
	</select>

	<!-- 코멘트 select -->
	<select id="selectComments" resultType="commentvo">
		<![CDATA[
			select  a.comment_no commentNo,
					a.comment_regdate commentRegdate,
					a.comment_contents commentContents,
					a.comment_like commentLike,
					a.user_no userNo,
					a.task_no taskNo,
					a.file_no fileNo,
			        b.user_name userName,
			        b.user_photo userPhoto,
			        c.origin_name originName,
			        c.file_path filePath,
			        c.file_regdate fileRegdate
			from comment a
			join user b on(a.user_no = b.user_no)
			left join file c on(a.file_no = c.file_no)
			where a.task_no = #{taskNo};
 		]]>
	</select>
	
	<!-- 파일 select -->
	<select id="selectFile" resultType="filevo">
		<![CDATA[
			select file_no fileNo,
				origin_name originName,
				change_name changeName,
				file_path filePath,
				file_regdate fileRegdate,
				task_no taskNo
			from file
			where task_no = #{taskNo};
 		]]>
	</select>
	
	<!-- 업무 유저 select -->
	<select id="selectMemberList" resultType="uservo">
		<![CDATA[
			select u.user_no userNo,
					u.user_regdate userRegdate,
					u.user_email userEmail,
					u.user_name userName,
					u.user_number userNumber,
					u.user_birth userBirth,
					u.user_title userTitle, 
					u.user_dept userDept, 
					u.user_photo userPhoto
			from user u
			join taskuser tu using(user_no)
			where task_no = 81;
 		]]>
	</select>

	<!-- 테스크 리스트 정렬 번호 select -->
	<select id="selectTaskListOrderNo" resultType="Long">
		<![CDATA[
            select max(tasklist_order)
            from tasklist
            where project_no = #{projectNo};
		]]>	
	</select>

	<!-- 테스크 리스트 insert -->
	<insert id="taskListAdd" parameterType="tasklistvo"> 
		<![CDATA[ 
			insert into tasklist values(null, #{taskListName}, #{taskListOrder}, #{projectNo});
		]]>
		<selectKey keyProperty="taskListNo" resultType="long"
			order="AFTER">
			select last_insert_id()
		</selectKey>
	</insert>

	<!-- <insert id="taskCopy" parameterType="taskvo"> <![CDATA[ insert into 
		taglist values(null, #{tagName}, #{tagColor}) ]]> <selectKey keyProperty 
		= "tagNo" resultType="long" order="AFTER"> select last_insert_id() </selectKey> 
		</insert> -->



</mapper>