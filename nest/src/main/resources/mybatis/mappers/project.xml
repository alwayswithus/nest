<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="project">
	<select id="selectPro" parameterType="long" resultType="projectvo">
	<![CDATA[
		select project.project_no as projectNo,
			   project_title as projectTitle,
			   project_desc as projectDesc,
			   date_format(project_start, '%Y-%m-%d %H:%i') as projectStart,
			   date_format(project_end, '%Y-%m-%d %H:%i') as projectEnd,
			   project_state as projectState 
	    from project, userproject, user 
	    where project.project_no = userproject.project_no 
	    and userproject.user_no = user.user_no
	    and user.user_no = #{authUserNo}
 		]]> 
	</select>
	<insert id="insertProjectNotMember" parameterType="projectvo">
	<![CDATA[
	insert into project values (null, #{projectTitle}, #{projectDesc}, #{projectStart}, #{projectEnd}, #{projectState})
	]]>
	<selectKey keyProperty = "projectNo" resultType="long" order="AFTER">
		select last_insert_id()
	</selectKey>
	</insert>
	
	<select id="selectUser" parameterType="map" resultType="uservo">
	<![CDATA[
	select userproject.user_no as userNo, role_no as roleNo, user_name as userName, user_email as userEmail, user_photo as userPhoto
	from project, userproject, user
	where project.project_no = userproject.project_no
	and userproject.user_no = user.user_no
	and project.project_no = #{projectNo}
	and user.user_no != #{userNo}
	]]>
	</select>
	
	<select id="selectProjectMember" parameterType="long" resultType="uservo">
		<![CDATA[
			select a.user_no as userNo, 
				   a.user_name as userName,
				   a.user_photo as userPhoto,
				   b.project_no as projectNo
			from user a, userproject b
			where a.user_no = b.user_no 
				  and project_no = #{projectNo};
		]]>
	</select>
	
	<insert id="insertAuthUser" parameterType="map">
	<![CDATA[
	insert into userproject values (#{projectNo}, #{userNo}, 1)
	]]>
	</insert>
	
	<insert id="insertUserProject" parameterType="map">
	<![CDATA[
	insert into userproject values (#{projectNo}, #{userNo}, 3)
	]]>
	</insert>
</mapper>
