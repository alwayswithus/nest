<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="task">
	<select id="selectTask" parameterType="long" resultType="taskvo">
	<![CDATA[
		select task_no as taskNo,
				task_start as taskStart,
				task_end as taskEnd,
				task_point as taskPoint,
				task_label as taskLabel,
				task_state as taskState,
				task_contents as taskContents,
				tasklist_no as tasklistNo,
				task.project_no as projectNo
		from task, (select project.project_no
					from project, userproject, user
					where project.project_no = userproject.project_no
					and userproject.user_no = user.user_no
					and user.user_no = #{authUserNo}) as b
		where task.project_no = b.project_no
		and task.task_state != "del"
	]]>
	</select>
	
	<select id="selectUser" parameterType="map" resultType="long">
	<![CDATA[
		select user_no as userNo
		from taskuser
		where task_no = #{taskNo} and user_no = #{authUserNo}
	]]>
	</select>
	
	<select id="selectTaskOrder" parameterType="taskvo" resultType="int">
	<![CDATA[
		select count(task_no) as taskOrder
        from task
        where tasklist_no = #{taskListNo} and project_no = #{projectNo}
	]]>
	</select>
	
	<insert id="taskAdd" parameterType="taskvo">
	<![CDATA[
		insert into task values (null, #{taskStart}, #{taskEnd}, #{taskPoint}, #{taskLabel}, #{taskState}, #{taskContents}, #{taskOrder}, #{taskRegdate}, #{taskListNo}, #{projectNo}, #{taskWriter})
	]]>
	<selectKey keyProperty = "taskNo" resultType="long" order="AFTER">
		select last_insert_id()
	</selectKey>
	</insert>
</mapper>
